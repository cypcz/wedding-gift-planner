# Migration `20200923190149-partner-flow`

This migration has been generated by Jakub at 9/23/2020, 9:01:49 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."GuestStatus" AS ENUM ('WAITING', 'ACCEPTED', 'REJECTED')

CREATE TYPE "public"."Currency" AS ENUM ('EUR', 'USD', 'CZK', 'UAH', 'RUB', 'GBP', 'HUF', 'AUD', 'NZD')

CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"email" text   NOT NULL ,
"weddingId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Guest" (
"id" text   NOT NULL ,
"firstName" text   NOT NULL ,
"lastName" text   NOT NULL ,
"plusX" integer   NOT NULL DEFAULT 0,
"plusGuests" text []  ,
"status" "GuestStatus"  NOT NULL DEFAULT E'WAITING',
"weddingId" text   NOT NULL ,
"userId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Wedding" (
"id" text   NOT NULL ,
"partner1Name" text   NOT NULL ,
"partner2Name" text   NOT NULL ,
"date" timestamp(3)   NOT NULL ,
"rsvpUntil" timestamp(3)   NOT NULL ,
"partnersEmail" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."GiftContribution" (
"id" text   NOT NULL ,
"amount" integer   NOT NULL ,
"currency" "Currency"  NOT NULL ,
"note" text   ,
"giftId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Gift" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"price" integer   NOT NULL ,
"currency" "Currency"  NOT NULL ,
"description" text   ,
"imgUrl" text   ,
"link" text   ,
"weddingId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_GiftContributionToGuest" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "_GiftContributionToGuest_AB_unique" ON "public"."_GiftContributionToGuest"("A", "B")

CREATE INDEX "_GiftContributionToGuest_B_index" ON "public"."_GiftContributionToGuest"("B")

ALTER TABLE "public"."User" ADD FOREIGN KEY ("weddingId")REFERENCES "public"."Wedding"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Guest" ADD FOREIGN KEY ("weddingId")REFERENCES "public"."Wedding"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Guest" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."GiftContribution" ADD FOREIGN KEY ("giftId")REFERENCES "public"."Gift"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Gift" ADD FOREIGN KEY ("weddingId")REFERENCES "public"."Wedding"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_GiftContributionToGuest" ADD FOREIGN KEY ("A")REFERENCES "public"."GiftContribution"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_GiftContributionToGuest" ADD FOREIGN KEY ("B")REFERENCES "public"."Guest"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200919204742-gifts..20200923190149-partner-flow
--- datamodel.dml
+++ datamodel.dml
@@ -1,6 +1,6 @@
 datasource postgresql {
-  url = "***"
+  url = "***"
   provider = "postgresql"
 }
 generator client {
@@ -27,9 +27,8 @@
   firstName  String
   lastName   String
   plusX      Int         @default(0)
   plusGuests String[]
-  guestLink  String
   status     GuestStatus @default(WAITING)
   wedding       Wedding            @relation(fields: [weddingId], references: [id])
   weddingId     String
@@ -38,12 +37,14 @@
   contributions GiftContribution[]
 }
 model Wedding {
-  id           String   @id @default(cuid())
-  partner1Name String
-  partner2Name String
-  date         DateTime
+  id            String   @id @default(cuid())
+  partner1Name  String
+  partner2Name  String
+  date          DateTime
+  rsvpUntil     DateTime
+  partnersEmail String?
   gifts   Gift[]
   guests  Guest[]
   authors User[]
```


