# Migration `20200919204742-gifts`

This migration has been generated by Jakub at 9/19/2020, 10:47:42 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."GuestStatus" AS ENUM ('WAITING', 'ACCEPTED', 'REJECTED')

CREATE TYPE "public"."Currency" AS ENUM ('EUR', 'USD', 'CZK', 'UAH', 'RUB', 'GBP', 'HUF', 'AUD', 'NZD')

CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"email" text   NOT NULL ,
"weddingId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Guest" (
"id" text   NOT NULL ,
"firstName" text   NOT NULL ,
"lastName" text   NOT NULL ,
"plusX" integer   NOT NULL DEFAULT 0,
"plusGuests" text []  ,
"guestLink" text   NOT NULL ,
"status" "GuestStatus"  NOT NULL DEFAULT E'WAITING',
"weddingId" text   NOT NULL ,
"userId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Wedding" (
"id" text   NOT NULL ,
"partner1Name" text   NOT NULL ,
"partner2Name" text   NOT NULL ,
"date" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."GiftContribution" (
"id" text   NOT NULL ,
"amount" integer   NOT NULL ,
"currency" "Currency"  NOT NULL ,
"note" text   ,
"giftId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Gift" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"price" integer   NOT NULL ,
"currency" "Currency"  NOT NULL ,
"description" text   ,
"imgUrl" text   ,
"link" text   ,
"weddingId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_GiftContributionToGuest" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "_GiftContributionToGuest_AB_unique" ON "public"."_GiftContributionToGuest"("A", "B")

CREATE INDEX "_GiftContributionToGuest_B_index" ON "public"."_GiftContributionToGuest"("B")

ALTER TABLE "public"."User" ADD FOREIGN KEY ("weddingId")REFERENCES "public"."Wedding"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Guest" ADD FOREIGN KEY ("weddingId")REFERENCES "public"."Wedding"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Guest" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."GiftContribution" ADD FOREIGN KEY ("giftId")REFERENCES "public"."Gift"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Gift" ADD FOREIGN KEY ("weddingId")REFERENCES "public"."Wedding"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_GiftContributionToGuest" ADD FOREIGN KEY ("A")REFERENCES "public"."GiftContribution"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_GiftContributionToGuest" ADD FOREIGN KEY ("B")REFERENCES "public"."Guest"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200919155448-authors..20200919204742-gifts
--- datamodel.dml
+++ datamodel.dml
@@ -1,6 +1,6 @@
 datasource postgresql {
-  url = "***"
+  url = "***"
   provider = "postgresql"
 }
 generator client {
@@ -30,12 +30,13 @@
   plusGuests String[]
   guestLink  String
   status     GuestStatus @default(WAITING)
-  wedding   Wedding @relation(fields: [weddingId], references: [id])
-  weddingId String
-  user      User?   @relation(fields: [userId], references: [id])
-  userId    String?
+  wedding       Wedding            @relation(fields: [weddingId], references: [id])
+  weddingId     String
+  user          User?              @relation(fields: [userId], references: [id])
+  userId        String?
+  contributions GiftContribution[]
 }
 model Wedding {
   id           String   @id @default(cuid())
@@ -47,11 +48,40 @@
   guests  Guest[]
   authors User[]
 }
+enum Currency {
+  EUR
+  USD
+  CZK
+  UAH
+  RUB
+  GBP
+  HUF
+  AUD
+  NZD
+}
+
+model GiftContribution {
+  id       String   @id @default(cuid())
+  amount   Int
+  currency Currency
+  note     String?
+
+  contributors Guest[]
+  gift         Gift    @relation(fields: [giftId], references: [id])
+  giftId       String
+}
+
 model Gift {
-  id   String @id @default(cuid())
-  name String
+  id          String   @id @default(cuid())
+  name        String
+  price       Int
+  currency    Currency
+  description String?
+  imgUrl      String?
+  link        String?
-  wedding   Wedding @relation(fields: [weddingId], references: [id])
-  weddingId String
+  contributions GiftContribution[]
+  wedding       Wedding            @relation(fields: [weddingId], references: [id])
+  weddingId     String
 }
```


